{"ast":null,"code":"var express = require(\"express\");\n\nvar app = express();\n\nvar passport = require(\"passport\");\n\nvar session = require(\"express-session\");\n\nvar bodyParser = require(\"body-parser\");\n\nvar env = require(\"dotenv\").load(); //For BodyParser\n\n\napp.use(bodyParser.urlencoded({\n  extended: true\n}));\napp.use(bodyParser.json()); // For Passport\n\napp.use(session({\n  secret: \"keyboard cat\",\n  resave: true,\n  saveUninitialized: true\n})); // session secret\n\napp.use(passport.initialize());\napp.use(passport.session()); // persistent login sessions\n\napp.use(function (req, res, next) {\n  // if the url is \"signin\" then proceed to that route\n  // we need this because otherwise we'd run into an infinite loop\n  // of redirecting to the /signin page over and over\n  if (req.url.indexOf('/signin') >= 0) return next();\n  if (req.url.indexOf('/signup') >= 0) return next(); // if the user is authenticated, allow everything\n\n  if (req.isAuthenticated()) return next(); // for everything else, redirect to the signin route\n\n  res.redirect(\"/signin\");\n});\napp.use(express.static(\"public\")); //Models\n\nvar models = require(\"./app/models\"); //Routes\n\n\nvar authRoute = require(\"./app/routes/auth.js\")(app, passport); //load passport strategies\n\n\nrequire(\"./app/config/passport/passport.js\")(passport, models.user); //Sync Database\n\n\nmodels.sequelize.sync().then(function () {\n  console.log(\"Nice! Database looks fine\");\n}).catch(function (err) {\n  console.log(err, \"Something went wrong with the Database Update!\");\n});\napp.listen(process.env.PORT || 3000, function (err) {\n  if (!err) console.log(\"Site is live\");else console.log(err);\n});","map":null,"metadata":{},"sourceType":"script"}